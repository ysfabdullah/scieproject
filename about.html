<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Try it out - AI in Education</title>
    <link rel="icon" href="images/education.png" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="logo">AI In Education</div>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="why.html">Why?</a></li>
                <li><a href="about.html">Try it out</a></li>
                <li><a href="learning.html">Get Started</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
        </nav>
    </header>

    <section class="content">
        <h2>Try it out</h2>
        <p>Experience how AI can enhance your learning journey.</p>
        
        <div class="chat-container">
            <div id="chatDisplay" class="chat-display"></div>
            <div class="input-container">
                <input type="text" id="userInput" placeholder="Type your message here..." />
                <button onclick="sendMessage()">Send</button>
            </div>
        </div>
    </section>

    <footer>
        <p>&copy; 2025 SCIE 331 Final Project</p>
    </footer>

    <script>
        const messages = [
            { 
                role: "system", 
                content: "You are an AI education assistant. Keep responses concise and focused on educational topics. Help students understand concepts better and provide clear explanations." 
            }
        ];

        async function sendMessage() {
            const userInput = document.getElementById('userInput');
            const message = userInput.value.trim();
            
            if (!message) return;

            // Add user message to display
            addMessageToDisplay(message, 'user');
            messages.push({ role: "user", content: message });
            userInput.value = '';

            // Show typing indicator
            const typingIndicator = showTypingIndicator();

            try {
                const response = await fetch('https://scieproject.vercel.app/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ messages }),
                });

                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                const data = await response.json();
                const assistantMessage = data.choices[0].message.content;
                
                // Remove typing indicator and add assistant message
                typingIndicator.remove();
                addMessageToDisplay(assistantMessage, 'assistant');
                messages.push({ role: "assistant", content: assistantMessage });

            } catch (error) {
                console.error('Error:', error);
                typingIndicator.remove();
                
                let errorMessage = "Sorry, I'm having trouble responding right now. Please try again later.";
                
                if (error.response) {
                    const errorData = await error.response.json();
                    errorMessage = errorData.details || errorData.error || errorMessage;
                }
                
                addMessageToDisplay(errorMessage, 'error');
            }
        }

        function addMessageToDisplay(message, type) {
            const chatDisplay = document.getElementById('chatDisplay');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}-message`;
            
            if (type === 'user') {
                messageDiv.innerHTML = `<strong>You:</strong> ${message}`;
            } else if (type === 'assistant') {
                messageDiv.innerHTML = `<strong>Assistant:</strong> ${message}`;
            } else {
                messageDiv.innerHTML = message;
            }
            
            chatDisplay.appendChild(messageDiv);
            chatDisplay.scrollTop = chatDisplay.scrollHeight;
        }

        function showTypingIndicator() {
            const chatDisplay = document.getElementById('chatDisplay');
            const indicator = document.createElement('div');
            indicator.className = 'typing-indicator';
            indicator.innerHTML = '<span></span><span></span><span></span>';
            chatDisplay.appendChild(indicator);
            chatDisplay.scrollTop = chatDisplay.scrollHeight;
            return indicator;
        }

        // Handle Enter key press
        document.getElementById('userInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>
